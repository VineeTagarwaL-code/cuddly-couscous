---
title: "How to correctly setup your vps ?  "
description: "In this blog, I will guide you through the correct way to setup your vps to host your websites correctly !"
date: "2023-12-30"
tags: ["self-hosting", "vps", "nginx", "pm2"]
---

<details>
  <summary>Content</summary>

  - [What is a VPS?](#what-is-a-vps)
  - [Setting up vps](#setting-up-vps)
  - Item 3

</details>
<br></br>

# What is a vps ? 

A VPS (Virtual Private Server) is a type of hosting service that provides a virtualized server environment. It acts like a dedicated physical server, but it is actually a virtual machine created by partitioning a physical server into multiple virtual servers. Each VPS runs its own operating system and has its own dedicated resources, such as CPU, RAM, and storage, which are isolated from other VPS instances on the same physical server.
# Setting up vps
Before starting, make sure you have your vps ready. So lets start !
 - ### Update your server
   Once you've logged into your VPS via SSH, the first step is to update your package lists to ensure you're working with the latest versions.
   
   ```shell
    sudo apt update && sudo apt upgrade -y
   ```
 - ### Setup user account
   Whenever you login to a new vps, always setup an user account. Its not a great idea to work as root user
      ```shell
    sudo adduser vineet # your username
    sudo usermod -aG sudo vineet # to add sudo perm to your user
    su - vineet # to switch to your new user
   ```
 - ### SSH using new user
   As we have already setup the new user, we should now setup ssh login for that user
   ```shell
   # follow these steps after completing the previous one
   mkdir -p ~/.ssh # make a .ssh folder 
   chmod 700 ~/.ssh # add permission to execute 
   sudo cp /home/ec2-user/.ssh/authorized_keys /home/new-user/.ssh/ # paste in new user's ssh folder
   sudo chown new-user:new-user /home/new-user/.ssh/authorized_keys # changing the ownership 
   chmod 600 /home/new-user/.ssh/authorized_keys
   ```
   Now logout and try to login back as new-user@ip
 
# Installing necessary softwares

To host your web applications on a VPS, you'll need a few essential software packages. we will cover how to install Node.js, PM2, Nginx, and Certbot. These tools will help you deploy, manage, and secure your applications. For demonstration purposes, we'll be deploying a Next.js project, which requires Node.js. However, you should install the software based on your specific application needs.

- ### Installing Nodejs
  Since we are deploying a Next.js project in this example, we will need to install Node.js. However, you should install whatever runtime environment suits your project (such as Python,   Ruby, etc.).

  ```shell
  curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash 
  source ~/.bashrc # activate your nvm 
  nvm intall --lts # install the latest LTS version of node
  ```

- ### Installing PM2
  PM2 is a production process manager for Node.js applications. It helps you keep your app running, even after a server reboot.

  ```shell
   npm install -g pm2
  ```
- ### Installing NGINX
  Nginx is a high-performance web server that you can use as a reverse proxy to serve your application.
  ```shell
   snap install nginx
   systemctl start nginx
   systemctl enable nginx
  ```
- ### Configuring NGINX
  Now we need to configure our reverse proxy to allow Nginx to forward incoming requests directed to the "server_name" to the local port where your application is running, as specified    in the Nginx configuration.
  ```shell
  sudo nano /etc/nginx/sites-available/default
  ```
  ```shell 
   server{ 
            
   listen 80;
   server_name blog.vineet.tech;
            
   location / { 
         proxy_pass http://localhost:3000; # Change 3000 to the port your app is running on
         proxy_http_version 1.1;
         proxy_set_header Upgrade $http_upgrade;
         proxy_set_header Connection 'upgrade';
         proxy_set_header Host $host;
         proxy_cache_bypass $http_upgrade;
        }
    }
  ```
  After the above chagnes are made, we should test if there are any syntax errors or not and then restart nginx 
   ```shell
     nginx -t # checks for errors 
     systemctl restart nginx
   ```
- ### Installing Git
  ```shell
   apt-get install git 
  ```
- ### Configuring git login through ssh
  We need to log in to our GitHub account on the VPS to access private repositories (if any) via SSH.
  ```shell
  cd ~/.ssh # go to your .ssh folder
  ssh-keygen -o -t rsa -C "email@example.com" # use the kye-gen command to generate the key pairs
  cat id_rsa.pub # Run `cat id_rsa.pub` and add the displayed key to your GitHub account under SSH keys.
  ```

# Starting your app 
For now, I'm starting the blog app that you're currently reading, and I'll be using PM2 to manage the process and handle restarts. Since I'm using PM2, Iâ€™ll create an ecosystem.config.js file to simplify starting and stopping processes.

```js
# root_of_your_project/ecosystem.config.js

module.exports = {
  apps: [
    {
      name: "blog",
      exec_mode: "fork",
      instances: "1",
      script: "./node_modules/next/dist/bin/next",
      args: "start",
      exp_backoff_restart_delay: 100,
      watch: true,
      max_memory_restart: "400M",
    },
  ],
};
```
